#!/bin/bash

set -e

BOT_NAME="anna_bot"
PROJECT_DIR="/home/sii/$BOT_NAME"   # путь к каталогу с git-репозиторием

echo "Проверяю рабочую директорию..."

if [ "$PWD" != "$PROJECT_DIR" ]; then
    echo "Текущая директория: $PWD"
    echo "Перехожу в $PROJECT_DIR"

    if [ ! -d "$PROJECT_DIR" ]; then
        echo "Ошибка: директория $PROJECT_DIR не существует"
        exit 1
    fi

    cd "$PROJECT_DIR"
fi

echo "Текущая рабочая директория: $(pwd)"

echo "Останавливаю сервис..."
sudo systemctl stop $BOT_NAME

echo "Обновляю репозиторий..."
git pull

echo "Запускаю сервис..."
sudo systemctl start $BOT_NAME

echo "Статус сервиса:"
systemctl status $BOT_NAME --no-pager
